# Fantasy Hockey Bot

Бот для сбора статистики хоккейных матчей и формирования команд дня/недели с публикацией в Telegram.

## Особенности

- Сбор статистики игроков через ESPN API
- Формирование команды дня и недели
- Создание коллажей с фотографиями игроков
- Публикация результатов в Telegram
- Система грейдов игроков (common, uncommon, rare, epic, legend)
- Хранение истории команд и статистики

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/fantasy-hockey-bot.git
cd fantasy-hockey-bot
```

2. Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

3. Создайте файл `.env` с необходимыми переменными окружения:
```
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
ESPN_SWID={your-swid}
ESPN_S2=your-s2-token
SEASON=2024
LEAGUE_ID=your_league_id
```

## Использование

### Сбор статистики за день

```bash
python scripts/app_day.py --date YYYY-MM-DD [--no-send]
```

Опции:
- `--date`: Дата для сбора статистики (формат YYYY-MM-DD)
- `--no-send`: Не отправлять результаты в Telegram (опционально)

### Сбор статистики за неделю

```bash
python scripts/app_week.py --week YYYY-MM-DD [--no-send]
```

Опции:
- `--week`: Дата начала недели (формат YYYY-MM-DD)
- `--no-send`: Не отправлять результаты в Telegram (опционально)

## Структура проекта

```
fantasy-hockey-bot/
├── data/                  # Директория для данных
│   ├── processed/        # Обработанные данные
│   ├── photos/          # Фотографии игроков
│   └── collages/        # Сгенерированные коллажи
├── src/                  # Исходный код
│   ├── services/        # Сервисы для работы с API и данными
│   └── utils/           # Вспомогательные функции
├── scripts/              # Скрипты для запуска
└── tests/                # Тесты
```

## Технические детали

### ESPN API

- Базовый URL: `https://fantasy.espn.com/apis/v3/games/fhl/seasons/2024/segments/0/leagues/1`
- Используется фиксированный `scoringPeriodId=92` (скорее всего он просто иекущий последний подгружается)
- Необходимы заголовки:
  - Cookie с `SWID` и `espn_s2`
  - `x-fantasy-source: kona`
  - `x-fantasy-platform`
  - `x-fantasy-filter` для фильтрации данных, как раз таки для того чтобы получить статистику за нужный день

### Система грейдов

- common: базовый грейд
- uncommon: 2+ появления в команде недели
- rare: 3+ появления
- epic: 4+ появления
- legend: 5+ появлений

## Советы для следующего ИИ

1. Текущий статус:
- Реализована базовая структура проекта
- Настроена работа с ESPN API
- Реализовано формирование команд дня и недели
- Добавлена система грейдов
- Настроено логирование

2. Следующие шаги:
- Улучшить обработку ошибок при работе с API
- Добавить кэширование запросов к API
- Реализовать сохранение фотографий игроков
- Добавить тесты для основных компонентов
- Улучшить форматирование сообщений для Telegram
- Добавить мониторинг состояния бота
- Реализовать автоматическое обновление токенов ESPN

3. Известные проблемы:
- API ESPN требует специальные заголовки для аутентификации
- Необходимо правильно формировать фильтры для получения статистики
- Возможны проблемы с SSL-сертификатами при запросах

4. Рекомендации:
- Использовать логирование для отладки запросов к API
- Проверять наличие всех необходимых заголовков
- Реализовать механизм повторных попыток при сбоях API
- Добавить валидацию данных от API
