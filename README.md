# Fantasy Hockey Bot

Бот для сбора и анализа статистики игроков NHL в фэнтези-хоккее ESPN. Бот формирует ежедневные и еженедельные команды лучших игроков, отслеживает их статистику и отправляет обновления в Telegram.

## Особенности

- Ежедневный сбор статистики игроков NHL
- Формирование команды дня с лучшими игроками на каждой позиции
- Создание еженедельных сводок и команд недели
- Система грейдов игроков (от common до legendary)
- Отправка красивых коллажей с фотографиями игроков в Telegram
- Ведение подробной статистики по каждому игроку
- Автоматическое восстановление после сбоев

## Структура проекта

```
fantasy-hockey-bot/
├── data/
│   ├── processed/    # Обработанные данные
│   ├── raw/         # Сырые данные
│   ├── temp/        # Временные файлы
│   ├── cache/       # Кэш
│   └── logs/        # Логи данных
├── logs/
│   └── app/         # Логи приложения
├── scripts/
│   ├── app_day.py   # Скрипт для ежедневного обновления
│   └── app_week.py  # Скрипт для еженедельного обновления
├── src/
│   ├── config/      # Конфигурационные файлы
│   ├── services/    # Сервисы для работы с данными
│   ├── telegram/    # Модули для работы с Telegram
│   └── utils/       # Вспомогательные функции
├── tests/           # Тесты
├── .env            # Файл с переменными окружения
├── .gitignore
├── requirements.txt # Зависимости проекта
└── README.md
```

## Установка

### Требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)
- git
- Доступ к API ESPN Fantasy Hockey
- Telegram бот и канал

### Шаги установки

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/fantasy-hockey-bot.git
cd fantasy-hockey-bot
```

2. Создайте и активируйте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте необходимые директории:
```bash
mkdir -p data/{processed,raw,temp,cache,logs}
mkdir -p logs/app
```

5. Создайте файл `.env` в корне проекта:
```env
TELEGRAM_TOKEN=ваш_токен_бота
CHAT_ID=ваш_идентификатор_чата
ESPN_SWID=ваш_swid
ESPN_S2=ваш_s2
```

## Использование

### Ежедневное обновление

Для сбора данных за текущий день:
```bash
python scripts/app_day.py
```

### Обработка предыдущей недели

Для сбора данных за предыдущую неделю:
```bash
python scripts/app_day.py --previous-week
```

### Обработка всех недель

Для сбора данных за все недели с начала сезона:
```bash
python scripts/app_day.py --all-weeks
```

### Еженедельное обновление

Для формирования команды недели:
```bash
python scripts/app_week.py
```

## Настройка автоматического запуска

### Linux (cron)

Добавьте следующие строки в crontab:
```bash
# Ежедневное обновление в 23:59
59 23 * * * cd /путь/к/проекту && source venv/bin/activate && python scripts/app_day.py

# Еженедельное обновление в понедельник в 23:59
59 23 * * 1 cd /путь/к/проекту && source venv/bin/activate && python scripts/app_week.py
```

### Windows (Task Scheduler)

Создайте задачи в планировщике задач Windows для запуска скриптов:
- `app_day.py` - ежедневно в 23:59
- `app_week.py` - еженедельно в понедельник в 23:59

## Логирование

Логи приложения сохраняются в:
- `logs/app/log.txt` - основной лог приложения
- `data/logs/` - логи обработки данных

## Устранение неполадок

1. Проблемы с подключением к API ESPN:
   - Проверьте правильность SWID и S2 в файле `.env`
   - Убедитесь в наличии доступа к лиге

2. Ошибки при отправке сообщений в Telegram:
   - Проверьте токен бота и ID чата
   - Убедитесь, что бот добавлен в канал/группу

3. Проблемы с кодировкой:
   - Убедитесь, что все файлы сохранены в UTF-8
   - Проверьте настройки локали в системе

## Лицензия

MIT License

## Поддержка

При возникновении проблем создайте issue в репозитории проекта.
