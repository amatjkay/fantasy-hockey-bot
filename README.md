# Fantasy Hockey Bot

Бот для сбора и анализа статистики игроков NHL в фэнтези-хоккее ESPN. Бот формирует ежедневные и еженедельные команды лучших игроков, отслеживает их статистику и отправляет обновления в Telegram.

## Особенности

- Ежедневный сбор статистики игроков NHL
- Формирование команды дня с лучшими игроками на каждой позиции
- Создание еженедельных сводок и команд недели
- Система грейдов игроков (от common до legendary)
- Отправка красивых коллажей с фотографиями игроков в Telegram
- Ведение подробной статистики по каждому игроку
- Автоматическое восстановление после сбоев
- Поддержка обработки всех недель с начала сезона
- Автоматическое создание и отправка коллажей для всех исторических данных
- Умная система определения периодов (с учетом часовых поясов)

## Структура проекта

```
fantasy-hockey-bot/
├── data/
│   ├── processed/    # Обработанные данные
│   ├── raw/         # Сырые данные
│   ├── temp/        # Временные файлы
│   ├── cache/       # Кэш
│   └── logs/        # Логи данных
├── logs/            # Логи приложения
├── scripts/
│   ├── app_day.py   # Скрипт для ежедневного обновления
│   └── app_week.py  # Скрипт для еженедельного обновления
├── src/
│   ├── config/      # Конфигурационные файлы
│   ├── services/    # Сервисы для работы с данными
│   ├── telegram/    # Модули для работы с Telegram
│   └── utils/       # Вспомогательные функции
├── tests/           # Тесты
├── .env            # Файл с переменными окружения
├── .gitignore
├── requirements.txt # Зависимости проекта
└── README.md
```

## Установка

### Требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)
- git
- Доступ к API ESPN Fantasy Hockey
- Telegram бот и канал

### Шаги установки

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/fantasy-hockey-bot.git
cd fantasy-hockey-bot
```

2. Создайте и активируйте виртуальное окружение:
```bash
python3 -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` в корне проекта:
```env
TELEGRAM_TOKEN=ваш_токен_бота
CHAT_ID=ваш_идентификатор_чата
ESPN_SWID=ваш_swid
ESPN_S2=ваш_s2
LEAGUE_ID=ваш_id_лиги
SEASON_ID=2025
SEASON_START=2024-10-04
TIMEZONE=US/Eastern
DAY_START_HOUR=4
```

## Использование

### Ежедневное обновление

Для сбора данных за текущий день:
```bash
python scripts/app_day.py
```

### Еженедельное обновление

Для формирования команды за предыдущую неделю:
```bash
python scripts/app_week.py
```

Для формирования и отправки команд за все недели с начала сезона:
```bash
python scripts/app_week.py --all-weeks
```

## Настройка автоматического запуска

### Linux (cron)

Добавьте следующие строки в crontab:
```bash
# Ежедневное обновление в 4:00 (учитывая часовой пояс NHL)
0 4 * * * cd /путь/к/проекту && source venv/bin/activate && python scripts/app_day.py

# Еженедельное обновление в понедельник в 4:00
0 4 * * 1 cd /путь/к/проекту && source venv/bin/activate && python scripts/app_week.py
```

### Windows (Task Scheduler)

Создайте задачи в планировщике задач Windows для запуска скриптов:
- `app_day.py` - ежедневно в 4:00
- `app_week.py` - еженедельно в понедельник в 4:00

## Логирование

Логи приложения сохраняются в:
- `logs/app.log` - основной лог приложения
- `data/logs/` - логи обработки данных

## Конфигурация

### Основные настройки

- `TIMEZONE`: Часовой пояс NHL (по умолчанию US/Eastern)
- `DAY_START_HOUR`: Час начала нового игрового дня (по умолчанию 4)
- `SEASON_START`: Дата начала сезона
- `SEASON_ID`: ID текущего сезона в ESPN

### Настройки изображений

- Размеры фотографий игроков: 130x100
- Размер коллажа: 500px в ширину
- Поддержка различных шрифтов
- Цветовая кодировка грейдов игроков

## Устранение неполадок

1. Проблемы с подключением к API ESPN:
   - Проверьте правильность SWID и S2 в файле `.env`
   - Убедитесь в наличии доступа к лиге
   - Проверьте корректность LEAGUE_ID и SEASON_ID

2. Ошибки при отправке сообщений в Telegram:
   - Проверьте токен бота и ID чата
   - Убедитесь, что бот добавлен в канал/группу
   - Проверьте права бота на отправку медиафайлов

3. Проблемы с временными зонами:
   - Убедитесь, что TIMEZONE соответствует часовому поясу NHL
   - Проверьте настройку DAY_START_HOUR
   - Проверьте системное время сервера

## Лицензия

MIT License

## Поддержка

При возникновении проблем создайте issue в репозитории проекта.
